<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Dashboard ‚Äì Firebase Realtime (REST)</title>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
      :root {
        --bg: #0b1020;
        --card: #121a35;
        --muted: #9aa7c7;
        --ok: #16a34a;
        --off: #ef4444;
        --ring: #2563eb;
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto,
          Ubuntu, Cantarell, "Helvetica Neue", Arial;
        background: var(--bg);
        color: #e6ecff;
      }
      .wrap {
        max-width: 1000px;
        margin: 24px auto;
        padding: 0 16px;
      }
      header {
        display: flex;
        gap: 12px;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 16px;
      }
      header h1 {
        font-size: 20px;
        margin: 0;
        font-weight: 600;
        letter-spacing: 0.2px;
      }
      .config {
        display: flex;
        gap: 8px;
        align-items: center;
        flex-wrap: wrap;
      }
      .input {
        background: #0c142b;
        border: 1px solid #233159;
        color: #e6ecff;
        padding: 8px 10px;
        border-radius: 10px;
        min-width: 260px;
      }
      .btn {
        background: #1e293b;
        border: 1px solid #334155;
        color: #e6ecff;
        padding: 8px 12px;
        border-radius: 10px;
        cursor: pointer;
      }
      .btn:hover {
        border-color: #4b5563;
      }
      .grid {
        display: grid;
        grid-template-columns: repeat(12, 1fr);
        gap: 14px;
      }
      .card {
        grid-column: span 4;
        background: var(--card);
        border: 1px solid #22325f;
        border-radius: 16px;
        padding: 14px;
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25);
      }
      .card.wide {
        grid-column: span 12;
      }
      .row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
      }
      .label {
        color: var(--muted);
        font-size: 12px;
        letter-spacing: 0.3px;
        text-transform: uppercase;
      }
      .value {
        font-weight: 700;
        font-size: 28px;
      }
      .pill {
        font-size: 12px;
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid #2a3b6f;
        background: #0d1530;
        color: #dbe3ff;
      }
      .state {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-weight: 600;
        padding: 8px 12px;
        border-radius: 12px;
        border: 1px solid #2a3b6f;
        background: #0d1530;
      }
      .dot {
        width: 10px;
        height: 10px;
        border-radius: 999px;
        background: #64748b;
        box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.15) inset;
      }
      .on .dot {
        background: var(--ok);
      }
      .off .dot {
        background: var(--off);
      }
      .foot {
        margin-top: 12px;
        color: var(--muted);
        font-size: 12px;
      }
      canvas {
        width: 100%;
        height: 280px;
      }
      @media (max-width: 860px) {
        .card {
          grid-column: span 12;
        }
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <h1>Dashboard ‚Äì Firebase Realtime (REST)</h1>
        <div class="config">
          <input
            id="endpoint"
            class="input"
            type="text"
            placeholder="URL do Realtime Database .json"
          />
          <input
            id="interval"
            class="input"
            type="number"
            min="500"
            step="500"
            value="2000"
            title="ms"
          />
          <button class="btn" id="apply">Conectar</button>
          <span class="pill" id="status">‚è≥ aguardando‚Ä¶</span>
        </div>
      </header>

      <section class="grid">
        <article class="card">
          <div class="label">Bot√£o</div>
          <div class="row">
            <div id="botaoState" class="state off">
              <span class="dot"></span><span id="botaoTxt">OFF</span>
            </div>
            <span id="botaoRaw" class="pill">‚Äî</span>
          </div>
        </article>
        <article class="card">
          <div class="label">LED</div>
          <div class="row">
            <div id="ledState" class="state off">
              <span class="dot"></span><span id="ledTxt">OFF</span>
            </div>
            <span id="ledRaw" class="pill">‚Äî</span>
          </div>
        </article>
        <article class="card">
          <div class="label">Tempo de vida</div>
          <div class="row">
            <div class="value" id="tempoVal">‚Äî</div>
            <span class="pill" id="lastUpdate">‚Äî</span>
          </div>
        </article>

        <article class="card wide">
          <div class="row">
            <div class="label">Hist√≥rico (tempo de vida)</div>
            <div class="pill">Ao vivo</div>
          </div>
          <canvas id="tempoChart"></canvas>
          <div class="foot">
            Dica: edite o endpoint se precisar autenticar (?auth=TOKEN) ou
            aponte para outro caminho, por ex.: <code>/sensores.json</code>.
          </div>
        </article>
      </section>
    </div>

    <script>
      // üëâ Seu endpoint (j√° preenchido com o do print). Altere se desejar.
      const DEFAULT_ENDPOINT =
        "https://grupo3-16a7b-default-rtdb.firebaseio.com/.json";

      const el = (id) => document.getElementById(id);
      const endpointInput = el("endpoint");
      const intervalInput = el("interval");
      const statusEl = el("status");

      endpointInput.value = DEFAULT_ENDPOINT;

      // Estado UI simples
      function setState(id, on) {
        const box = el(id + "State");
        const txt = el(id + "Txt");
        const raw = el(id + "Raw");
        if (!box || !txt || !raw) return;
        box.classList.toggle("on", !!on);
        box.classList.toggle("off", !on);
        txt.textContent = on ? "ON" : "OFF";
        raw.textContent = String(on);
      }

      // Chart.js ‚Äì s√©rie do tempo de vida
      const chartCtx = document.getElementById("tempoChart");
      const chart = new Chart(chartCtx, {
        type: "line",
        data: {
          labels: [],
          datasets: [
            { label: "tempo de vida", data: [], tension: 0.25, fill: false },
          ],
        },
        options: {
          responsive: true,
          animation: false,
          plugins: { legend: { display: false } },
          scales: { y: { beginAtZero: true } },
        },
      });

      function pushTempo(v) {
        const max = 40; // pontos no gr√°fico
        const now = new Date();
        chart.data.labels.push(now.toLocaleTimeString());
        chart.data.datasets[0].data.push(v);
        if (chart.data.labels.length > max) {
          chart.data.labels.shift();
          chart.data.datasets[0].data.shift();
        }
        chart.update("none");
      }

      let timer = null;

      function startPolling() {
        const url = endpointInput.value.trim();
        const every = Math.max(parseInt(intervalInput.value, 10) || 2000, 500);

        if (timer) {
          clearInterval(timer);
          timer = null;
        }

        async function tick() {
          try {
            statusEl.textContent = "üîÑ atualizando‚Ä¶";
            const res = await fetch(url, { cache: "no-cache" });
            if (!res.ok) throw new Error("HTTP " + res.status);
            const data = await res.json();

            // Tenta nomes flex√≠veis (ex.: tempovida vs tempoVida)
            const botao = data?.botao ?? data?.button ?? data?.estadoBotao;
            const led = data?.led ?? data?.lampada ?? data?.estadoLed;
            const tempoVida =
              data?.tempovida ?? data?.tempoVida ?? data?.uptime ?? null;

            setState("botao", !!botao);
            setState("led", !!led);
            if (tempoVida !== null && tempoVida !== undefined) {
              const n = Number(tempoVida);
              el("tempoVal").textContent = Number.isFinite(n)
                ? n
                : String(tempoVida);
              if (Number.isFinite(n)) pushTempo(n);
            } else {
              el("tempoVal").textContent = "‚Äî";
            }

            el("lastUpdate").textContent =
              "Atualizado " + new Date().toLocaleTimeString();
            statusEl.textContent = "üü¢ conectado";
          } catch (err) {
            statusEl.textContent = "üî¥ erro: " + err.message;
          }
        }

        tick();
        timer = setInterval(tick, every);
      }

      document.getElementById("apply").addEventListener("click", startPolling);

      // conecta automaticamente ao carregar
      startPolling();
    </script>
  </body>
</html>
